[
  {
    "id": "total_value",
    "name": "Total Value",
    "version": "1.0.0",
    "description": "User's total asset value (denominated in USDC), including assets that cannot be used as collateral.",
    "formula": "Total Value = total_holding + total unsettlement PNL",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "totalUnsettlementPnL",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "USDCHolding",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "nonUSDCHolding",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": true
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  const { totalUnsettlementPnL, USDCHolding, nonUSDCHolding } = inputs;\n  const nonUSDCHoldingValue = nonUSDCHolding.reduce((acc, cur) => {\n    return new Decimal(cur.holding).mul(cur.indexPrice).add(acc);\n  }, zero);\n  return nonUSDCHoldingValue.add(USDCHolding).add(totalUnsettlementPnL);\n}",
    "sourceCode": "export function totalValue(inputs: TotalValueInputs): Decimal {\n  const { totalUnsettlementPnL, USDCHolding, nonUSDCHolding } = inputs;\n  const nonUSDCHoldingValue = nonUSDCHolding.reduce((acc, cur) => {\n    return new Decimal(cur.holding).mul(cur.indexPrice).add(acc);\n  }, zero);\n  return nonUSDCHoldingValue.add(USDCHolding).add(totalUnsettlementPnL);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "totalValue",
      "enabled": true
    }
  },
  {
    "id": "free_collateral",
    "name": "freeCollateral",
    "version": "1.0.0",
    "description": "\nCalculate free collateral.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "totalCollateral",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "totalInitialMarginWithOrders",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  const value = inputs.totalCollateral.sub(inputs.totalInitialMarginWithOrders);\n  // free collateral cannot be less than 0\n  return value.isNegative() ? zero : value;\n}",
    "sourceCode": "export function freeCollateral(inputs: FreeCollateralInputs): Decimal {\n  const value = inputs.totalCollateral.sub(inputs.totalInitialMarginWithOrders);\n  // free collateral cannot be less than 0\n  return value.isNegative() ? zero : value;\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "freeCollateral",
      "enabled": true
    }
  },
  {
    "id": "total_collateral",
    "name": "totalCollateral",
    "version": "1.0.0",
    "description": "\nCalculate total collateral.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "USDCHolding",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "nonUSDCHolding",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": true
              }
            },
            {
              "key": "unsettlementPnL",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  const { USDCHolding, nonUSDCHolding, unsettlementPnL } = inputs;\n  const nonUSDCHoldingValue = nonUSDCHolding.reduce<Decimal>((acc, cur) => {\n    const finalHolding = Math.min(cur.holding, cur.collateralCap);\n    const value = new Decimal(finalHolding)\n      .mul(cur.collateralRatio)\n      .mul(cur.indexPrice);\n    return acc.add(value);\n  }, zero);\n\n  return new Decimal(USDCHolding).add(nonUSDCHoldingValue).add(unsettlementPnL);\n}",
    "sourceCode": "export function totalCollateral(inputs: TotalCollateralValueInputs): Decimal {\n  const { USDCHolding, nonUSDCHolding, unsettlementPnL } = inputs;\n  const nonUSDCHoldingValue = nonUSDCHolding.reduce<Decimal>((acc, cur) => {\n    const finalHolding = Math.min(cur.holding, cur.collateralCap);\n    const value = new Decimal(finalHolding)\n      .mul(cur.collateralRatio)\n      .mul(cur.indexPrice);\n    return acc.add(value);\n  }, zero);\n\n  return new Decimal(USDCHolding).add(nonUSDCHoldingValue).add(unsettlementPnL);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "totalCollateral",
      "enabled": true
    }
  },
  {
    "id": "position_notional_with_order_by_symbol",
    "name": "positionNotionalWithOrder_by_symbol",
    "version": "1.0.0",
    "description": "\nSum of notional value for a symbol's position and orders.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "markPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "positionQtyWithOrders",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  return new Decimal(inputs.markPrice).mul(inputs.positionQtyWithOrders);\n}",
    "sourceCode": "export function positionNotionalWithOrder_by_symbol(\n  inputs: PositionNotionalWithOrderInputs,\n): Decimal {\n  return new Decimal(inputs.markPrice).mul(inputs.positionQtyWithOrders);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "positionNotionalWithOrder_by_symbol",
      "enabled": true
    }
  },
  {
    "id": "position_qty_with_orders_by_symbol",
    "name": "positionQtyWithOrders_by_symbol",
    "version": "1.0.0",
    "description": "\n Sum of position quantity and orders quantity for a symbol.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "positionQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "buyOrdersQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "sellOrdersQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  const { positionQty, buyOrdersQty, sellOrdersQty } = inputs;\n  const positionQtyDecimal = new Decimal(positionQty);\n  const qty = Math.max(\n    positionQtyDecimal.add(buyOrdersQty).abs().toNumber(),\n    positionQtyDecimal.sub(sellOrdersQty).abs().toNumber(),\n  );\n\n  return qty;\n}",
    "sourceCode": "export function positionQtyWithOrders_by_symbol(\n  inputs: PositionQtyWithOrderInputs,\n): number {\n  const { positionQty, buyOrdersQty, sellOrdersQty } = inputs;\n  const positionQtyDecimal = new Decimal(positionQty);\n  const qty = Math.max(\n    positionQtyDecimal.add(buyOrdersQty).abs().toNumber(),\n    positionQtyDecimal.sub(sellOrdersQty).abs().toNumber(),\n  );\n\n  return qty;\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "positionQtyWithOrders_by_symbol",
      "enabled": true
    }
  },
  {
    "id": "i_m_r",
    "name": "IMR",
    "version": "1.0.0",
    "description": "\nInitial margin rate for a symbol.\nMax(1 / Max Account Leverage, Base IMR i, IMR Factor i * Abs(Position Notional i + Order Notional i)^(4/5))",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "maxLeverage",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "baseIMR",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_Factor",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "positionNotional",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "ordersNotional",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_factor_power",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  const {\n    maxLeverage,\n    baseIMR,\n    IMR_Factor,\n    positionNotional,\n    ordersNotional: orderNotional,\n    IMR_factor_power = IMRFactorPower,\n  } = inputs;\n  return Math.max(\n    1 / maxLeverage,\n    baseIMR,\n    new Decimal(IMR_Factor)\n      .mul(\n        new Decimal(positionNotional)\n          .add(orderNotional)\n          .abs()\n          .toPower(IMR_factor_power),\n      )\n      .toNumber(),\n  );\n}",
    "sourceCode": "export function IMR(inputs: IMRInputs): number {\n  const {\n    maxLeverage,\n    baseIMR,\n    IMR_Factor,\n    positionNotional,\n    ordersNotional: orderNotional,\n    IMR_factor_power = IMRFactorPower,\n  } = inputs;\n  return Math.max(\n    1 / maxLeverage,\n    baseIMR,\n    new Decimal(IMR_Factor)\n      .mul(\n        new Decimal(positionNotional)\n          .add(orderNotional)\n          .abs()\n          .toPower(IMR_factor_power),\n      )\n      .toNumber(),\n  );\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "IMR",
      "enabled": true
    }
  },
  {
    "id": "get_qty_from_positions",
    "name": "getQtyFromPositions",
    "version": "1.0.0",
    "description": "\nGet the quantity of a specified symbol from the list of positions.",
    "inputs": [
      {
        "key": "positions",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": true,
          "properties": [
            {
              "key": "account_id",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "symbol",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "position_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "cost_position",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "last_sum_unitary_funding",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pending_long_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pending_short_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "settle_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "average_open_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_index",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_ROI",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unsettled_pnl",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unsettled_pnl_ROI",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_ROI_index",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "mark_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "index_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "est_liq_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "timestamp",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "mmr",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "imr",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_withdraw_orders",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "MMR_with_orders",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pnl_24_h",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fee_24_h",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fundingFee",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "leverage",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      },
      {
        "key": "symbol",
        "type": "string",
        "factorType": {
          "baseType": "string",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  if (!positions) {\n    return 0;\n  }\n  const position = positions.find((item) => item.symbol === symbol);\n  return position?.position_qty || 0;\n}",
    "sourceCode": "export function getQtyFromPositions(\n  positions: API.Position[],\n  symbol: string,\n): number {\n  if (!positions) {\n    return 0;\n  }\n  const position = positions.find((item) => item.symbol === symbol);\n  return position?.position_qty || 0;\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "getQtyFromPositions",
      "enabled": true
    }
  },
  {
    "id": "get_qty_from_orders_by_side",
    "name": "getQtyFromOrdersBySide",
    "version": "1.0.0",
    "description": "\nGet the quantity of long and short orders for a specified symbol from the list of orders.",
    "inputs": [
      {
        "key": "orders",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": true,
          "properties": [
            {
              "key": "symbol",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "status",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "side",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "order_id",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "algo_order_id",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "user_id",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "type",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "quantity",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "amount",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "visible",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "executed",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "total_fee",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fee_asset",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "client_order_id",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "average_executed_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "total_executed_quantity",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "visible_quantity",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "created_time",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "updated_time",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "reduce_only",
              "type": "boolean",
              "factorType": {
                "baseType": "boolean",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trigger_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "order_tag",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      },
      {
        "key": "symbol",
        "type": "string",
        "factorType": {
          "baseType": "string",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      },
      {
        "key": "side",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "toString",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "charAt",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "charCodeAt",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "concat",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "indexOf",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "lastIndexOf",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "localeCompare",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "match",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "replace",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "search",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "slice",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "split",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "substring",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toLowerCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toLocaleLowerCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toUpperCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toLocaleUpperCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trim",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "length",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "substr",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "valueOf",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "codePointAt",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "includes",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "endsWith",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "normalize",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "repeat",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "startsWith",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "anchor",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "big",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "blink",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "bold",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fixed",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fontcolor",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fontsize",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "italics",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "link",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "small",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "strike",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "sub",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "sup",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "padStart",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "padEnd",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimEnd",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimStart",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimLeft",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimRight",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "matchAll",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "__@iterator@263",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  const ordersBySide =\n    side === OrderSide.SELL\n      ? sellOrdersFilter_by_symbol(orders, symbol)\n      : buyOrdersFilter_by_symbol(orders, symbol);\n  return ordersBySide.reduce((acc, cur) => {\n    return acc + cur.quantity;\n  }, 0);\n}",
    "sourceCode": "export function getQtyFromOrdersBySide(\n  orders: API.Order[],\n  symbol: string,\n  side: OrderSide,\n): number {\n  const ordersBySide =\n    side === OrderSide.SELL\n      ? sellOrdersFilter_by_symbol(orders, symbol)\n      : buyOrdersFilter_by_symbol(orders, symbol);\n  return ordersBySide.reduce((acc, cur) => {\n    return acc + cur.quantity;\n  }, 0);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "getQtyFromOrdersBySide",
      "enabled": true
    }
  },
  {
    "id": "total_initial_margin_with_orders",
    "name": "totalInitialMarginWithOrders",
    "version": "1.0.0",
    "description": "",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "positions",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": true
              }
            },
            {
              "key": "orders",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": true
              }
            },
            {
              "key": "markPrices",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "symbolInfo",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_Factors",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "maxLeverage",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  const {\n    positions,\n    orders,\n    markPrices,\n    IMR_Factors,\n    maxLeverage,\n    symbolInfo,\n  } = inputs;\n\n  const symbols = extractSymbols(positions, orders);\n\n  const total_initial_margin_with_orders = symbols.reduce((acc, cur) => {\n    const symbol = cur;\n    const positionQty = getQtyFromPositions(positions, symbol);\n    const buyOrdersQty = getQtyFromOrdersBySide(orders, symbol, OrderSide.BUY);\n    const sellOrdersQty = getQtyFromOrdersBySide(\n      orders,\n      symbol,\n      OrderSide.SELL,\n    );\n\n    const markPrice = markPrices[symbol] || 0;\n\n    //---\n    const positionQtyWithOrders = positionQtyWithOrders_by_symbol({\n      positionQty,\n      buyOrdersQty,\n      sellOrdersQty,\n    });\n\n    //---\n    const position_notional_with_orders = positionNotionalWithOrder_by_symbol({\n      markPrice,\n      positionQtyWithOrders,\n    });\n\n    //----\n    const markPriceDecimal = new Decimal(markPrice);\n\n    const imr = IMR({\n      positionNotional: markPriceDecimal.mul(positionQty).toNumber(),\n      ordersNotional: markPriceDecimal\n        .mul(new Decimal(buyOrdersQty).add(sellOrdersQty))\n        .toNumber(),\n      maxLeverage,\n      IMR_Factor: IMR_Factors[symbol],\n      baseIMR: symbolInfo[symbol](\"base_imr\", 0),\n    });\n\n    return position_notional_with_orders.mul(imr).add(acc).toNumber();\n  }, 0);\n\n  return total_initial_margin_with_orders;\n}",
    "sourceCode": "export function totalInitialMarginWithOrders(\n  inputs: TotalInitialMarginWithOrdersInputs,\n): number {\n  const {\n    positions,\n    orders,\n    markPrices,\n    IMR_Factors,\n    maxLeverage,\n    symbolInfo,\n  } = inputs;\n\n  const symbols = extractSymbols(positions, orders);\n\n  const total_initial_margin_with_orders = symbols.reduce((acc, cur) => {\n    const symbol = cur;\n    const positionQty = getQtyFromPositions(positions, symbol);\n    const buyOrdersQty = getQtyFromOrdersBySide(orders, symbol, OrderSide.BUY);\n    const sellOrdersQty = getQtyFromOrdersBySide(\n      orders,\n      symbol,\n      OrderSide.SELL,\n    );\n\n    const markPrice = markPrices[symbol] || 0;\n\n    //---\n    const positionQtyWithOrders = positionQtyWithOrders_by_symbol({\n      positionQty,\n      buyOrdersQty,\n      sellOrdersQty,\n    });\n\n    //---\n    const position_notional_with_orders = positionNotionalWithOrder_by_symbol({\n      markPrice,\n      positionQtyWithOrders,\n    });\n\n    //----\n    const markPriceDecimal = new Decimal(markPrice);\n\n    const imr = IMR({\n      positionNotional: markPriceDecimal.mul(positionQty).toNumber(),\n      ordersNotional: markPriceDecimal\n        .mul(new Decimal(buyOrdersQty).add(sellOrdersQty))\n        .toNumber(),\n      maxLeverage,\n      IMR_Factor: IMR_Factors[symbol],\n      baseIMR: symbolInfo[symbol](\"base_imr\", 0),\n    });\n\n    return position_notional_with_orders.mul(imr).add(acc).toNumber();\n  }, 0);\n\n  return total_initial_margin_with_orders;\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "totalInitialMarginWithOrders",
      "enabled": true
    }
  },
  {
    "id": "group_orders_by_symbol",
    "name": "groupOrdersBySymbol",
    "version": "1.0.0",
    "description": "\nGroup orders by symbol, as a symbol can have multiple orders.",
    "inputs": [
      {
        "key": "orders",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": true,
          "properties": [
            {
              "key": "symbol",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "status",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "side",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "order_id",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "algo_order_id",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "user_id",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "type",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "quantity",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "amount",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "visible",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "executed",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "total_fee",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fee_asset",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "client_order_id",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "average_executed_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "total_executed_quantity",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "visible_quantity",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "created_time",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "updated_time",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "reduce_only",
              "type": "boolean",
              "factorType": {
                "baseType": "boolean",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trigger_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "order_tag",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number"
        }
      }
    ],
    "formulaText": "{\n  const symbols: { [key: string]: API.Order[] } = {};\n\n  orders.forEach((item) => {\n    if (!symbols[item.symbol]) {\n      symbols[item.symbol] = [];\n    }\n\n    symbols[item.symbol].push(item);\n  });\n\n  return symbols;\n}",
    "sourceCode": "export function groupOrdersBySymbol(orders: API.Order[]) {\n  const symbols: { [key: string]: API.Order[] } = {};\n\n  orders.forEach((item) => {\n    if (!symbols[item.symbol]) {\n      symbols[item.symbol] = [];\n    }\n\n    symbols[item.symbol].push(item);\n  });\n\n  return symbols;\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "groupOrdersBySymbol",
      "enabled": true
    }
  },
  {
    "id": "extract_symbols",
    "name": "extractSymbols",
    "version": "1.0.0",
    "description": "\nExtracts all unique symbols from positions and orders.",
    "inputs": [
      {
        "key": "positions",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": true,
          "properties": [
            {
              "key": "symbol",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      },
      {
        "key": "orders",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": true,
          "properties": [
            {
              "key": "symbol",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "string",
        "factorType": {
          "baseType": "string",
          "nullable": false,
          "array": true
        },
        "description": "An array of unique symbols."
      }
    ],
    "formulaText": "{\n  const symbols = new Set<string>();\n\n  positions.forEach((item) => {\n    symbols.add(item.symbol);\n  });\n\n  orders.forEach((item) => {\n    symbols.add(item.symbol);\n  });\n\n  return Array.from(symbols);\n}",
    "sourceCode": "export function extractSymbols(\n  positions: Pick<API.Position, \"symbol\">[],\n  orders: Pick<API.Order, \"symbol\">[],\n): string[] {\n  const symbols = new Set<string>();\n\n  positions.forEach((item) => {\n    symbols.add(item.symbol);\n  });\n\n  orders.forEach((item) => {\n    symbols.add(item.symbol);\n  });\n\n  return Array.from(symbols);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "extractSymbols",
      "enabled": true
    }
  },
  {
    "id": "other_i_ms",
    "name": "otherIMs",
    "version": "1.0.0",
    "description": "\nTotal margin used by other symbols (except the current symbol).",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "positions",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": true
              }
            },
            {
              "key": "markPrices",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "maxLeverage",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "symbolInfo",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_Factors",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  const {\n    // orders,\n    positions,\n    IMR_Factors,\n    symbolInfo,\n    markPrices,\n  } = inputs;\n\n  const symbols = positions.map((item) => item.symbol);\n\n  return symbols\n    .reduce((acc, cur) => {\n      const symbol = cur;\n\n      if (typeof markPrices[symbol] === \"undefined\") {\n        console.warn(\"markPrices[%s] is undefined\", symbol);\n        return acc;\n      }\n\n      const markPriceDecimal = new Decimal(markPrices[symbol] || 0);\n\n      const position = positions.find((item) => item.symbol === symbol);\n\n      const positionQty = getQtyFromPositions(positions, symbol);\n      const positionNotional = markPriceDecimal.mul(positionQty).toNumber();\n\n      const buyOrdersQty = position!.pending_long_qty;\n      const sellOrdersQty = position!.pending_short_qty;\n\n      const ordersNotional = markPriceDecimal\n        .mul(new Decimal(buyOrdersQty).add(sellOrdersQty))\n        .toNumber();\n\n      const IMR_Factor = IMR_Factors[symbol];\n\n      // IMR_Factor is possible to be 0\n      if (typeof IMR_Factor === \"undefined\") {\n        console.warn(\"IMR_Factor is not found:\", symbol);\n        return acc;\n      }\n\n      const imr = IMR({\n        maxLeverage: maxLeverage({\n          symbolLeverage: position!.leverage,\n          accountLeverage: inputs.maxLeverage,\n        }),\n        IMR_Factor,\n        baseIMR: symbolInfo[symbol](\"base_imr\", 0),\n        positionNotional,\n        ordersNotional,\n      });\n\n      const positionQtyWithOrders = positionQtyWithOrders_by_symbol({\n        positionQty,\n        buyOrdersQty,\n        sellOrdersQty,\n      });\n\n      const positionNotionalWithOrders = positionNotionalWithOrder_by_symbol({\n        markPrice: markPrices[symbol] || 0,\n        positionQtyWithOrders,\n      });\n\n      return acc.add(positionNotionalWithOrders.mul(imr));\n    }, zero)\n    .toNumber();\n}",
    "sourceCode": "export function otherIMs(inputs: OtherIMsInputs): number {\n  const {\n    // orders,\n    positions,\n    IMR_Factors,\n    symbolInfo,\n    markPrices,\n  } = inputs;\n\n  const symbols = positions.map((item) => item.symbol);\n\n  return symbols\n    .reduce((acc, cur) => {\n      const symbol = cur;\n\n      if (typeof markPrices[symbol] === \"undefined\") {\n        console.warn(\"markPrices[%s] is undefined\", symbol);\n        return acc;\n      }\n\n      const markPriceDecimal = new Decimal(markPrices[symbol] || 0);\n\n      const position = positions.find((item) => item.symbol === symbol);\n\n      const positionQty = getQtyFromPositions(positions, symbol);\n      const positionNotional = markPriceDecimal.mul(positionQty).toNumber();\n\n      const buyOrdersQty = position!.pending_long_qty;\n      const sellOrdersQty = position!.pending_short_qty;\n\n      const ordersNotional = markPriceDecimal\n        .mul(new Decimal(buyOrdersQty).add(sellOrdersQty))\n        .toNumber();\n\n      const IMR_Factor = IMR_Factors[symbol];\n\n      // IMR_Factor is possible to be 0\n      if (typeof IMR_Factor === \"undefined\") {\n        console.warn(\"IMR_Factor is not found:\", symbol);\n        return acc;\n      }\n\n      const imr = IMR({\n        maxLeverage: maxLeverage({\n          symbolLeverage: position!.leverage,\n          accountLeverage: inputs.maxLeverage,\n        }),\n        IMR_Factor,\n        baseIMR: symbolInfo[symbol](\"base_imr\", 0),\n        positionNotional,\n        ordersNotional,\n      });\n\n      const positionQtyWithOrders = positionQtyWithOrders_by_symbol({\n        positionQty,\n        buyOrdersQty,\n        sellOrdersQty,\n      });\n\n      const positionNotionalWithOrders = positionNotionalWithOrder_by_symbol({\n        markPrice: markPrices[symbol] || 0,\n        positionQtyWithOrders,\n      });\n\n      return acc.add(positionNotionalWithOrders.mul(imr));\n    }, zero)\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "otherIMs",
      "enabled": true
    }
  },
  {
    "id": "max_qty",
    "name": "maxQty",
    "version": "1.0.0",
    "description": "\nMaximum order quantity.",
    "inputs": [
      {
        "key": "side",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "toString",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "charAt",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "charCodeAt",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "concat",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "indexOf",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "lastIndexOf",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "localeCompare",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "match",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "replace",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "search",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "slice",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "split",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "substring",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toLowerCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toLocaleLowerCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toUpperCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toLocaleUpperCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trim",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "length",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "substr",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "valueOf",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "codePointAt",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "includes",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "endsWith",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "normalize",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "repeat",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "startsWith",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "anchor",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "big",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "blink",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "bold",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fixed",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fontcolor",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fontsize",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "italics",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "link",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "small",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "strike",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "sub",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "sup",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "padStart",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "padEnd",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimEnd",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimStart",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimLeft",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimRight",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "matchAll",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "__@iterator@263",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      },
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "symbol",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "baseMaxQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "totalCollateral",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "maxLeverage",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "baseIMR",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "otherIMs",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "markPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "positionQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "buyOrdersQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "sellOrdersQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_Factor",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "takerFeeRate",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      },
      {
        "key": "options",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "dp",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  if (side === OrderSide.BUY) {\n    return maxQtyByLong(inputs);\n  }\n  return maxQtyByShort(inputs);\n}",
    "sourceCode": "export function maxQty(\n  side: OrderSide,\n  inputs: MaxQtyInputs,\n  options?: ResultOptions,\n): number {\n  if (side === OrderSide.BUY) {\n    return maxQtyByLong(inputs);\n  }\n  return maxQtyByShort(inputs);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "maxQty",
      "enabled": true
    }
  },
  {
    "id": "total_margin_ratio",
    "name": "totalMarginRatio",
    "version": "1.0.0",
    "description": "\ntotal margin ratio",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "totalCollateral",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "markPrices",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "positions",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": true
              }
            }
          ]
        }
      },
      {
        "key": "dp",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  const { totalCollateral, markPrices, positions } = inputs;\n\n  if (totalCollateral === 0) {\n    return 0;\n  }\n\n  const totalCollateralDecimal = new Decimal(totalCollateral);\n\n  const totalPositionNotional = positions.reduce((acc, cur) => {\n    const markPrice = markPrices[cur.symbol] || 0;\n    return acc.add(new Decimal(cur.position_qty).mul(markPrice).abs());\n  }, zero);\n\n  if (totalPositionNotional.eq(zero)) {\n    return 0;\n  }\n\n  return totalCollateralDecimal.div(totalPositionNotional).toNumber();\n}",
    "sourceCode": "export function totalMarginRatio(\n  inputs: TotalMarginRatioInputs,\n  dp?: number,\n): number {\n  const { totalCollateral, markPrices, positions } = inputs;\n\n  if (totalCollateral === 0) {\n    return 0;\n  }\n\n  const totalCollateralDecimal = new Decimal(totalCollateral);\n\n  const totalPositionNotional = positions.reduce((acc, cur) => {\n    const markPrice = markPrices[cur.symbol] || 0;\n    return acc.add(new Decimal(cur.position_qty).mul(markPrice).abs());\n  }, zero);\n\n  if (totalPositionNotional.eq(zero)) {\n    return 0;\n  }\n\n  return totalCollateralDecimal.div(totalPositionNotional).toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "totalMarginRatio",
      "enabled": true
    }
  },
  {
    "id": "total_unrealized_r_o_i",
    "name": "totalUnrealizedROI",
    "version": "1.0.0",
    "description": "\ntotalUnrealizedROI",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "totalUnrealizedPnL",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "totalValue",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number"
        }
      }
    ],
    "formulaText": "{\n  const { totalUnrealizedPnL, totalValue } = inputs;\n\n  return new Decimal(totalUnrealizedPnL)\n    .div(totalValue - totalUnrealizedPnL)\n    .toNumber();\n}",
    "sourceCode": "export function totalUnrealizedROI(inputs: TotalUnrealizedROIInputs) {\n  const { totalUnrealizedPnL, totalValue } = inputs;\n\n  return new Decimal(totalUnrealizedPnL)\n    .div(totalValue - totalUnrealizedPnL)\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "totalUnrealizedROI",
      "enabled": true
    }
  },
  {
    "id": "current_leverage",
    "name": "currentLeverage",
    "version": "1.0.0",
    "description": "\ncurrent account leverage",
    "inputs": [
      {
        "key": "totalMarginRatio",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number"
        }
      }
    ],
    "formulaText": "{\n  if (totalMarginRatio === 0) {\n    return 0;\n  }\n  return 1 / totalMarginRatio;\n}",
    "sourceCode": "export function currentLeverage(totalMarginRatio: number) {\n  if (totalMarginRatio === 0) {\n    return 0;\n  }\n  return 1 / totalMarginRatio;\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "currentLeverage",
      "enabled": true
    }
  },
  {
    "id": "m_m_r",
    "name": "MMR",
    "version": "1.0.0",
    "description": "\ntotal maintenance margin ratio",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "positionsMMR",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "positionsNotional",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "number|null"
      }
    ],
    "formulaText": "{\n  // If the user does not have any positions, return null\n  if (inputs.positionsNotional === 0) {\n    return null;\n  }\n  if (inputs.positionsMMR === 0) {\n    return null;\n  }\n  return new Decimal(inputs.positionsMMR)\n    .div(inputs.positionsNotional)\n    .toNumber();\n}",
    "sourceCode": "export function MMR(inputs: AccountMMRInputs): number | null {\n  // If the user does not have any positions, return null\n  if (inputs.positionsNotional === 0) {\n    return null;\n  }\n  if (inputs.positionsMMR === 0) {\n    return null;\n  }\n  return new Decimal(inputs.positionsMMR)\n    .div(inputs.positionsNotional)\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "MMR",
      "enabled": true
    }
  },
  {
    "id": "max_price",
    "name": "maxPrice",
    "version": "1.0.0",
    "description": "\nMaximum price when placing an order",
    "inputs": [
      {
        "key": "markprice",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      },
      {
        "key": "range",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number"
        }
      }
    ],
    "formulaText": "{\n  return markprice * (1 + range);\n}",
    "sourceCode": "export function maxPrice(markprice: number, range: number) {\n  return markprice * (1 + range);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "maxPrice",
      "enabled": true
    }
  },
  {
    "id": "min_price",
    "name": "minPrice",
    "version": "1.0.0",
    "description": "\nMinimum price when placing an order",
    "inputs": [
      {
        "key": "markprice",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      },
      {
        "key": "range",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number"
        }
      }
    ],
    "formulaText": "{\n  return markprice * (1 - range);\n}",
    "sourceCode": "export function minPrice(markprice: number, range: number) {\n  return markprice * (1 - range);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "minPrice",
      "enabled": true
    }
  },
  {
    "id": "scope_price",
    "name": "scopePrice",
    "version": "1.0.0",
    "description": "\nScope price when placing an order",
    "inputs": [
      {
        "key": "price",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      },
      {
        "key": "scope",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      },
      {
        "key": "side",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {
            "enum": [
              "SELL"
            ]
          },
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "toString",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "charAt",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "charCodeAt",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "concat",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "indexOf",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "lastIndexOf",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "localeCompare",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "match",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "replace",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "search",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "slice",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "split",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "substring",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toLowerCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toLocaleLowerCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toUpperCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "toLocaleUpperCase",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trim",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "length",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "substr",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "valueOf",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "codePointAt",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "includes",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "endsWith",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "normalize",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "repeat",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "startsWith",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "anchor",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "big",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "blink",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "bold",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fixed",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fontcolor",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fontsize",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "italics",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "link",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "small",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "strike",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "sub",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "sup",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "padStart",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "padEnd",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimEnd",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimStart",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimLeft",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "trimRight",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "matchAll",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "__@iterator@263",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "number"
      }
    ],
    "formulaText": "{\n  if (side === \"BUY\") {\n    return price * (1 - scope);\n  }\n  return price * (1 + scope);\n}",
    "sourceCode": "export function scopePrice(\n  price: number,\n  scope: number,\n  side: \"BUY\" | \"SELL\",\n): number {\n  if (side === \"BUY\") {\n    return price * (1 - scope);\n  }\n  return price * (1 + scope);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "scopePrice",
      "enabled": true
    }
  },
  {
    "id": "order_fee",
    "name": "orderFee",
    "version": "1.0.0",
    "description": "\nCalculate the order fee",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "futuresTakeFeeRate",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  return new Decimal(inputs.qty)\n    .mul(inputs.price)\n    .mul(inputs.futuresTakeFeeRate)\n    .toNumber();\n}",
    "sourceCode": "export function orderFee(inputs: {\n  /**\n   * Order quantity\n   */\n  qty: number;\n  price: number;\n  futuresTakeFeeRate: number;\n}): number {\n  return new Decimal(inputs.qty)\n    .mul(inputs.price)\n    .mul(inputs.futuresTakeFeeRate)\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "orderFee",
      "enabled": true
    }
  },
  {
    "id": "est_liq_price",
    "name": "estLiqPrice",
    "version": "1.0.0",
    "description": "\nEstimated liquidation price",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "totalCollateral",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "markPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "baseMMR",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "baseIMR",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_Factor",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "orderFee",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "positions",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": true
              }
            },
            {
              "key": "newOrder",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false,
                "properties": [
                  {
                    "key": "symbol",
                    "type": "string",
                    "factorType": {
                      "baseType": "string",
                      "nullable": false,
                      "array": false
                    }
                  },
                  {
                    "key": "qty",
                    "type": "number",
                    "factorType": {
                      "baseType": "number",
                      "nullable": false,
                      "array": false
                    }
                  },
                  {
                    "key": "price",
                    "type": "number",
                    "factorType": {
                      "baseType": "number",
                      "nullable": false,
                      "array": false
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  const {\n    positions,\n    newOrder,\n    totalCollateral,\n    markPrice,\n    baseIMR,\n    baseMMR,\n    orderFee,\n    IMR_Factor,\n  } = inputs;\n  // opened positions for the symbol\n  let currentPosition:\n    | Pick<\n        orderUtils.PositionExt,\n        \"position_qty\" | \"mark_price\" | \"symbol\" | \"mmr\"\n      >\n    | undefined = undefined;\n\n  let newTotalMM = zero;\n\n  const hasPosition =\n    positions.filter((item) => item.position_qty > 0).length > 0;\n\n  const basePrice = hasPosition ? markPrice : newOrder.price;\n\n  const newOrderNotional = new Decimal(newOrder.qty).mul(newOrder.price);\n\n  for (let index = 0; index < positions.length; index++) {\n    const position = positions[index];\n    let notional = new Decimal(position.position_qty).mul(position.mark_price);\n    if (newOrder.symbol === position.symbol) {\n      currentPosition = position;\n      notional = notional.add(newOrderNotional);\n    }\n\n    newTotalMM = newTotalMM.add(notional.abs().mul(position.mmr));\n  }\n\n  // if no position\n  if (!currentPosition) {\n    newTotalMM = newTotalMM.add(newOrderNotional.mul(baseMMR));\n  }\n\n  const newMMR = Math.max(\n    baseMMR,\n    new Decimal(baseMMR)\n      .div(baseIMR)\n      .mul(IMR_Factor)\n      .mul(\n        newOrderNotional\n          .add(\n            !!currentPosition\n              ? new Decimal(currentPosition.position_qty).mul(\n                  currentPosition.mark_price,\n                )\n              : zero,\n          )\n          .abs(),\n      )\n      .toPower(4 / 5)\n      .toNumber(),\n  );\n\n  // console.log(\"new MMR\", newMMR, newTotalMM.toNumber());\n\n  const newQty = new Decimal(newOrder.qty).add(\n    currentPosition?.position_qty ?? 0,\n  );\n\n  if (newQty.eq(0)) {\n    return 0;\n  }\n\n  const denominator = newQty.abs().mul(newMMR).sub(newQty);\n\n  if (denominator.eq(zero)) {\n    return 0;\n  }\n\n  const price = new Decimal(basePrice)\n    .add(\n      new Decimal(totalCollateral)\n        .sub(newTotalMM)\n        .sub(orderFee)\n        .div(denominator),\n    )\n    .toNumber();\n\n  return Math.max(0, price);\n}",
    "sourceCode": "export function estLiqPrice(inputs: EstimatedLiquidationPriceInputs): number {\n  const {\n    positions,\n    newOrder,\n    totalCollateral,\n    markPrice,\n    baseIMR,\n    baseMMR,\n    orderFee,\n    IMR_Factor,\n  } = inputs;\n  // opened positions for the symbol\n  let currentPosition:\n    | Pick<\n        orderUtils.PositionExt,\n        \"position_qty\" | \"mark_price\" | \"symbol\" | \"mmr\"\n      >\n    | undefined = undefined;\n\n  let newTotalMM = zero;\n\n  const hasPosition =\n    positions.filter((item) => item.position_qty > 0).length > 0;\n\n  const basePrice = hasPosition ? markPrice : newOrder.price;\n\n  const newOrderNotional = new Decimal(newOrder.qty).mul(newOrder.price);\n\n  for (let index = 0; index < positions.length; index++) {\n    const position = positions[index];\n    let notional = new Decimal(position.position_qty).mul(position.mark_price);\n    if (newOrder.symbol === position.symbol) {\n      currentPosition = position;\n      notional = notional.add(newOrderNotional);\n    }\n\n    newTotalMM = newTotalMM.add(notional.abs().mul(position.mmr));\n  }\n\n  // if no position\n  if (!currentPosition) {\n    newTotalMM = newTotalMM.add(newOrderNotional.mul(baseMMR));\n  }\n\n  const newMMR = Math.max(\n    baseMMR,\n    new Decimal(baseMMR)\n      .div(baseIMR)\n      .mul(IMR_Factor)\n      .mul(\n        newOrderNotional\n          .add(\n            !!currentPosition\n              ? new Decimal(currentPosition.position_qty).mul(\n                  currentPosition.mark_price,\n                )\n              : zero,\n          )\n          .abs(),\n      )\n      .toPower(4 / 5)\n      .toNumber(),\n  );\n\n  // console.log(\"new MMR\", newMMR, newTotalMM.toNumber());\n\n  const newQty = new Decimal(newOrder.qty).add(\n    currentPosition?.position_qty ?? 0,\n  );\n\n  if (newQty.eq(0)) {\n    return 0;\n  }\n\n  const denominator = newQty.abs().mul(newMMR).sub(newQty);\n\n  if (denominator.eq(zero)) {\n    return 0;\n  }\n\n  const price = new Decimal(basePrice)\n    .add(\n      new Decimal(totalCollateral)\n        .sub(newTotalMM)\n        .sub(orderFee)\n        .div(denominator),\n    )\n    .toNumber();\n\n  return Math.max(0, price);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "estLiqPrice",
      "enabled": true
    }
  },
  {
    "id": "est_leverage",
    "name": "estLeverage",
    "version": "1.0.0",
    "description": "\nEstimated leverage",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "totalCollateral",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "positions",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": true
              }
            },
            {
              "key": "newOrder",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": false,
                "properties": [
                  {
                    "key": "symbol",
                    "type": "string",
                    "factorType": {
                      "baseType": "string",
                      "nullable": false,
                      "array": false
                    }
                  },
                  {
                    "key": "qty",
                    "type": "number",
                    "factorType": {
                      "baseType": "number",
                      "nullable": false,
                      "array": false
                    }
                  },
                  {
                    "key": "price",
                    "type": "number",
                    "factorType": {
                      "baseType": "number",
                      "nullable": false,
                      "array": false
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "number"
      }
    ],
    "formulaText": "{\n  const { totalCollateral, positions, newOrder } = inputs;\n  if (totalCollateral <= 0) {\n    return null;\n  }\n  let hasPosition = false;\n  let sumPositionNotional = positions.reduce((acc, cur) => {\n    let count = new Decimal(cur.position_qty).mul(cur.mark_price);\n    // acc = acc.add(\n    //   new Decimal(cur.position_qty).mul(cur.mark_price)\n    //   // .abs()\n    // );\n\n    if (cur.symbol === newOrder.symbol) {\n      hasPosition = true;\n      // acc = acc.add(new Decimal(newOrder.qty).mul(newOrder.price));\n      count = count.add(new Decimal(newOrder.qty).mul(newOrder.price));\n    }\n\n    return acc.add(count.abs());\n  }, zero);\n\n  if (!hasPosition) {\n    sumPositionNotional = sumPositionNotional.add(\n      new Decimal(newOrder.qty).mul(newOrder.price).abs(),\n    );\n  }\n\n  if (sumPositionNotional.eq(zero)) {\n    return null;\n  }\n\n  const totalMarginRatio = new Decimal(totalCollateral).div(\n    sumPositionNotional,\n  );\n\n  return new Decimal(1)\n    .div(totalMarginRatio)\n    .toDecimalPlaces(2, Decimal.ROUND_HALF_EVEN)\n    .toNumber();\n}",
    "sourceCode": "export function estLeverage(inputs: EstimatedLeverageInputs): number | null {\n  const { totalCollateral, positions, newOrder } = inputs;\n  if (totalCollateral <= 0) {\n    return null;\n  }\n  let hasPosition = false;\n  let sumPositionNotional = positions.reduce((acc, cur) => {\n    let count = new Decimal(cur.position_qty).mul(cur.mark_price);\n    // acc = acc.add(\n    //   new Decimal(cur.position_qty).mul(cur.mark_price)\n    //   // .abs()\n    // );\n\n    if (cur.symbol === newOrder.symbol) {\n      hasPosition = true;\n      // acc = acc.add(new Decimal(newOrder.qty).mul(newOrder.price));\n      count = count.add(new Decimal(newOrder.qty).mul(newOrder.price));\n    }\n\n    return acc.add(count.abs());\n  }, zero);\n\n  if (!hasPosition) {\n    sumPositionNotional = sumPositionNotional.add(\n      new Decimal(newOrder.qty).mul(newOrder.price).abs(),\n    );\n  }\n\n  if (sumPositionNotional.eq(zero)) {\n    return null;\n  }\n\n  const totalMarginRatio = new Decimal(totalCollateral).div(\n    sumPositionNotional,\n  );\n\n  return new Decimal(1)\n    .div(totalMarginRatio)\n    .toDecimalPlaces(2, Decimal.ROUND_HALF_EVEN)\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "estLeverage",
      "enabled": true
    }
  },
  {
    "id": "notional",
    "name": "notional",
    "version": "1.0.0",
    "description": "\nCalculates the notional value of a single position.",
    "inputs": [
      {
        "key": "qty",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      },
      {
        "key": "mark_price",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "constraints": {},
          "nullable": false,
          "array": false
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "The notional value of the position."
      }
    ],
    "formulaText": "{\n  return new Decimal(qty).mul(mark_price).abs().toNumber();\n}",
    "sourceCode": "export function notional(qty: number, mark_price: number): number {\n  return new Decimal(qty).mul(mark_price).abs().toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "notional",
      "enabled": true
    }
  },
  {
    "id": "total_notional",
    "name": "totalNotional",
    "version": "1.0.0",
    "description": "\nCalculates the total notional value of all positions.",
    "inputs": [
      {
        "key": "positions",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": true,
          "properties": [
            {
              "key": "account_id",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "symbol",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "position_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "cost_position",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "last_sum_unitary_funding",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pending_long_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pending_short_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "settle_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "average_open_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_index",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_ROI",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unsettled_pnl",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unsettled_pnl_ROI",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_ROI_index",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "mark_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "index_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "est_liq_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "timestamp",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "mmr",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "imr",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_withdraw_orders",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "MMR_with_orders",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pnl_24_h",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fee_24_h",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fundingFee",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "leverage",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "The total notional value of all positions."
      }
    ],
    "formulaText": "{\n  return positions.reduce((acc, cur) => {\n    return acc + notional(cur.position_qty, cur.mark_price);\n  }, 0);\n}",
    "sourceCode": "export function totalNotional(positions: API.Position[]): number {\n  return positions.reduce((acc, cur) => {\n    return acc + notional(cur.position_qty, cur.mark_price);\n  }, 0);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "totalNotional",
      "enabled": true
    }
  },
  {
    "id": "unrealized_pn_l",
    "name": "unrealizedPnL",
    "version": "1.0.0",
    "description": "\nCalculates the unrealized profit or loss of a single position.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "markPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "openPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "The unrealized profit or loss of the position."
      }
    ],
    "formulaText": "{\n  return new Decimal(inputs.qty)\n    .mul(inputs.markPrice - inputs.openPrice)\n    .toNumber();\n}",
    "sourceCode": "export function unrealizedPnL(inputs: UnrealPnLInputs): number {\n  return new Decimal(inputs.qty)\n    .mul(inputs.markPrice - inputs.openPrice)\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "unrealizedPnL",
      "enabled": true
    }
  },
  {
    "id": "unrealized_pn_l_r_o_i",
    "name": "unrealizedPnLROI",
    "version": "1.0.0",
    "description": "\nCalculates the return on investment (ROI) of a single position's unrealized profit or loss.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "positionQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "openPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealizedPnL",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "The ROI of the position's unrealized profit or loss."
      }
    ],
    "formulaText": "{\n  const { openPrice, IMR } = inputs;\n\n  if (\n    inputs.unrealizedPnL === 0 ||\n    inputs.positionQty === 0 ||\n    openPrice === 0 ||\n    IMR === 0\n  )\n    return 0;\n\n  return new Decimal(inputs.unrealizedPnL)\n    .div(new Decimal(Math.abs(inputs.positionQty)).mul(openPrice).mul(IMR))\n    .toNumber();\n}",
    "sourceCode": "export function unrealizedPnLROI(inputs: UnrealPnLROIInputs): number {\n  const { openPrice, IMR } = inputs;\n\n  if (\n    inputs.unrealizedPnL === 0 ||\n    inputs.positionQty === 0 ||\n    openPrice === 0 ||\n    IMR === 0\n  )\n    return 0;\n\n  return new Decimal(inputs.unrealizedPnL)\n    .div(new Decimal(Math.abs(inputs.positionQty)).mul(openPrice).mul(IMR))\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "unrealizedPnLROI",
      "enabled": true
    }
  },
  {
    "id": "total_unrealized_pn_l",
    "name": "totalUnrealizedPnL",
    "version": "1.0.0",
    "description": "\nCalculates the total unrealized profit or loss of all positions.",
    "inputs": [
      {
        "key": "positions",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": true,
          "properties": [
            {
              "key": "account_id",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "symbol",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "position_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "cost_position",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "last_sum_unitary_funding",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pending_long_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pending_short_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "settle_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "average_open_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_index",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_ROI",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unsettled_pnl",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unsettled_pnl_ROI",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_ROI_index",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "mark_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "index_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "est_liq_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "timestamp",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "mmr",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "imr",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_withdraw_orders",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "MMR_with_orders",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pnl_24_h",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fee_24_h",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fundingFee",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "leverage",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "The total unrealized profit or loss of all positions."
      }
    ],
    "formulaText": "{\n  return positions.reduce((acc, cur) => {\n    return (\n      acc +\n      unrealizedPnL({\n        qty: cur.position_qty,\n        openPrice: cur.average_open_price,\n        markPrice: cur.mark_price,\n      })\n    );\n  }, 0);\n}",
    "sourceCode": "export function totalUnrealizedPnL(positions: API.Position[]): number {\n  return positions.reduce((acc, cur) => {\n    return (\n      acc +\n      unrealizedPnL({\n        qty: cur.position_qty,\n        openPrice: cur.average_open_price,\n        markPrice: cur.mark_price,\n      })\n    );\n  }, 0);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "totalUnrealizedPnL",
      "enabled": true
    }
  },
  {
    "id": "liq_price",
    "name": "liqPrice",
    "version": "1.0.0",
    "description": "\nCalculates the liquidation price of a single position.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "markPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "totalCollateral",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "positionQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "positions",
              "type": "object",
              "factorType": {
                "baseType": "object",
                "nullable": false,
                "array": true
              }
            },
            {
              "key": "MMR",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "The liquidation price of the position."
      }
    ],
    "formulaText": "{\n  const { markPrice, totalCollateral, positions, positionQty, MMR } = inputs;\n\n  // console.log(\"inputs\", inputs);\n\n  if (positionQty === 0 || totalCollateral === 0) {\n    return null;\n  }\n\n  // totalNotional of all poisitions\n  const totalNotional = positions.reduce<Decimal>((acc, cur) => {\n    return acc.add(\n      new Decimal(notional(cur.position_qty, cur.mark_price)).mul(cur.mmr),\n    );\n  }, zero);\n\n  return Math.max(\n    new Decimal(markPrice)\n      .add(\n        new Decimal(totalCollateral)\n          .sub(totalNotional)\n          .div(new Decimal(positionQty).abs().mul(MMR).sub(positionQty)),\n      )\n      .toNumber(),\n    0,\n  );\n}",
    "sourceCode": "export function liqPrice(inputs: LiqPriceInputs): number | null {\n  const { markPrice, totalCollateral, positions, positionQty, MMR } = inputs;\n\n  // console.log(\"inputs\", inputs);\n\n  if (positionQty === 0 || totalCollateral === 0) {\n    return null;\n  }\n\n  // totalNotional of all poisitions\n  const totalNotional = positions.reduce<Decimal>((acc, cur) => {\n    return acc.add(\n      new Decimal(notional(cur.position_qty, cur.mark_price)).mul(cur.mmr),\n    );\n  }, zero);\n\n  return Math.max(\n    new Decimal(markPrice)\n      .add(\n        new Decimal(totalCollateral)\n          .sub(totalNotional)\n          .div(new Decimal(positionQty).abs().mul(MMR).sub(positionQty)),\n      )\n      .toNumber(),\n    0,\n  );\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "liqPrice",
      "enabled": true
    }
  },
  {
    "id": "maintenance_margin",
    "name": "maintenanceMargin",
    "version": "1.0.0",
    "description": "\nCalculates the maintenance margin of a position.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "positionQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "markPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "MMR",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number"
        },
        "description": "The maintenance margin of the position."
      }
    ],
    "formulaText": "{\n  const { positionQty, markPrice, MMR } = inputs;\n\n  return new Decimal(positionQty).mul(markPrice).mul(MMR).abs().toNumber();\n}",
    "sourceCode": "export function maintenanceMargin(inputs: MMInputs) {\n  const { positionQty, markPrice, MMR } = inputs;\n\n  return new Decimal(positionQty).mul(markPrice).mul(MMR).abs().toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "maintenanceMargin",
      "enabled": true
    }
  },
  {
    "id": "unsettlement_pn_l",
    "name": "unsettlementPnL",
    "version": "1.0.0",
    "description": "\nCalculates the unrealized profit or loss of each position.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "positionQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "markPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "costPosition",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "sumUnitaryFunding",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "lastSumUnitaryFunding",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "The unrealized profit or loss of each position."
      }
    ],
    "formulaText": "{\n  const {\n    positionQty,\n    markPrice,\n    costPosition,\n    sumUnitaryFunding,\n    lastSumUnitaryFunding,\n  } = inputs;\n\n  const qty = new Decimal(positionQty);\n\n  return qty\n    .mul(markPrice)\n    .sub(costPosition)\n    .sub(qty.mul(new Decimal(sumUnitaryFunding).sub(lastSumUnitaryFunding)))\n    .toNumber();\n}",
    "sourceCode": "export function unsettlementPnL(inputs: UnsettlementPnLInputs): number {\n  const {\n    positionQty,\n    markPrice,\n    costPosition,\n    sumUnitaryFunding,\n    lastSumUnitaryFunding,\n  } = inputs;\n\n  const qty = new Decimal(positionQty);\n\n  return qty\n    .mul(markPrice)\n    .sub(costPosition)\n    .sub(qty.mul(new Decimal(sumUnitaryFunding).sub(lastSumUnitaryFunding)))\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "unsettlementPnL",
      "enabled": true
    }
  },
  {
    "id": "total_unsettlement_pn_l",
    "name": "totalUnsettlementPnL",
    "version": "1.0.0",
    "description": "\nCalculates the total unrealized profit or loss of all positions.",
    "inputs": [
      {
        "key": "positions",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": true,
          "properties": [
            {
              "key": "account_id",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "symbol",
              "type": "string",
              "factorType": {
                "baseType": "string",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "position_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "cost_position",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "last_sum_unitary_funding",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pending_long_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pending_short_qty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "settle_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "average_open_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_index",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_ROI",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unsettled_pnl",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unsettled_pnl_ROI",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "unrealized_pnl_ROI_index",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "mark_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "index_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "est_liq_price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "timestamp",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "mmr",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "imr",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_withdraw_orders",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "MMR_with_orders",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pnl_24_h",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fee_24_h",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "fundingFee",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "leverage",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "sum_unitary_funding",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "The total unrealized profit or loss of all positions."
      }
    ],
    "formulaText": "{\n  if (!Array.isArray(positions) || positions.length === 0) {\n    return 0;\n  }\n\n  return positions.reduce((acc, cur) => {\n    return (\n      acc +\n      unsettlementPnL({\n        positionQty: cur.position_qty,\n        markPrice: cur.mark_price,\n        costPosition: cur.cost_position,\n        sumUnitaryFunding: cur.sum_unitary_funding,\n        lastSumUnitaryFunding: cur.last_sum_unitary_funding,\n      })\n    );\n  }, 0);\n}",
    "sourceCode": "export function totalUnsettlementPnL(\n  positions: (API.Position & { sum_unitary_funding: number })[],\n): number {\n  if (!Array.isArray(positions) || positions.length === 0) {\n    return 0;\n  }\n\n  return positions.reduce((acc, cur) => {\n    return (\n      acc +\n      unsettlementPnL({\n        positionQty: cur.position_qty,\n        markPrice: cur.mark_price,\n        costPosition: cur.cost_position,\n        sumUnitaryFunding: cur.sum_unitary_funding,\n        lastSumUnitaryFunding: cur.last_sum_unitary_funding,\n      })\n    );\n  }, 0);\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "totalUnsettlementPnL",
      "enabled": true
    }
  },
  {
    "id": "m_m_r",
    "name": "Total Maintenance Margin Ratio",
    "version": "1.0.0",
    "description": "Calculates the maintenance margin requirement (MMR) of a position.",
    "formula": "Total Maintenance Margin Ratio  = sum ( Position maintenance margin ) / total_position_notional * 100%",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "baseMMR",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "baseIMR",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMRFactor",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "positionNotional",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMR_factor_power",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "The MMR of the position."
      }
    ],
    "formulaText": "{\n  const {\n    baseMMR,\n    baseIMR,\n    IMRFactor,\n    positionNotional,\n    IMR_factor_power = IMRFactorPower,\n  } = inputs;\n  return Math.max(\n    baseMMR,\n    new Decimal(baseMMR)\n      .div(baseIMR)\n      .mul(IMRFactor)\n      .mul(Math.pow(Math.abs(positionNotional), IMR_factor_power))\n      // .toPower(IMR_factor_power)\n      .toNumber(),\n  );\n}",
    "sourceCode": "export function MMR(inputs: MMRInputs): number {\n  const {\n    baseMMR,\n    baseIMR,\n    IMRFactor,\n    positionNotional,\n    IMR_factor_power = IMRFactorPower,\n  } = inputs;\n  return Math.max(\n    baseMMR,\n    new Decimal(baseMMR)\n      .div(baseIMR)\n      .mul(IMRFactor)\n      .mul(Math.pow(Math.abs(positionNotional), IMR_factor_power))\n      // .toPower(IMR_factor_power)\n      .toNumber(),\n  );\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "MMR",
      "enabled": true
    }
  },
  {
    "id": "est_pn_l_for_t_p",
    "name": "estPnLForTP",
    "version": "1.0.0",
    "description": "\nCalculates the profit or loss for take profit.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "positionQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "entryPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        },
        "description": "The profit or loss for take profit."
      }
    ],
    "formulaText": "{\n  return new Decimal(inputs.positionQty)\n    .mul(new Decimal(inputs.price).sub(inputs.entryPrice))\n    .toNumber();\n}",
    "sourceCode": "export function estPnLForTP(inputs: {\n  positionQty: number;\n  entryPrice: number;\n  price: number;\n}): number {\n  return new Decimal(inputs.positionQty)\n    .mul(new Decimal(inputs.price).sub(inputs.entryPrice))\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "estPnLForTP",
      "enabled": true
    }
  },
  {
    "id": "est_price_for_t_p",
    "name": "estPriceForTP",
    "version": "1.0.0",
    "description": "\nCalculates the estimated price for take profit.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "positionQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "entryPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "pnl",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  return new Decimal(inputs.pnl)\n    .add(inputs.entryPrice)\n    .div(inputs.positionQty)\n    .toNumber();\n}",
    "sourceCode": "export function estPriceForTP(inputs: {\n  positionQty: number;\n  entryPrice: number;\n  pnl: number;\n}): number {\n  return new Decimal(inputs.pnl)\n    .add(inputs.entryPrice)\n    .div(inputs.positionQty)\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "estPriceForTP",
      "enabled": true
    }
  },
  {
    "id": "est_offset_for_t_p",
    "name": "estOffsetForTP",
    "version": "1.0.0",
    "description": "\nCalculates the estimated offset for take profit.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "price",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "entryPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  return new Decimal(inputs.price).div(inputs.entryPrice).toNumber();\n}",
    "sourceCode": "export function estOffsetForTP(inputs: {\n  price: number;\n  entryPrice: number;\n}): number {\n  return new Decimal(inputs.price).div(inputs.entryPrice).toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "estOffsetForTP",
      "enabled": true
    }
  },
  {
    "id": "est_price_from_offset_for_t_p",
    "name": "estPriceFromOffsetForTP",
    "version": "1.0.0",
    "description": "\nCalculates the estimated price from offset for take profit.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "offset",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "entryPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  return new Decimal(inputs.offset).add(inputs.entryPrice).toNumber();\n}",
    "sourceCode": "export function estPriceFromOffsetForTP(inputs: {\n  offset: number;\n  entryPrice: number;\n}): number {\n  return new Decimal(inputs.offset).add(inputs.entryPrice).toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "estPriceFromOffsetForTP",
      "enabled": true
    }
  },
  {
    "id": "est_pn_l_for_s_l",
    "name": "estPnLForSL",
    "version": "1.0.0",
    "description": "\nCalculates the PnL for stop loss.",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "positionQty",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "entryPrice",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number",
          "nullable": false,
          "array": false
        }
      }
    ],
    "formulaText": "{\n  return 0;\n}",
    "sourceCode": "export function estPnLForSL(inputs: {\n  positionQty: number;\n  entryPrice: number;\n}): number {\n  return 0;\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "estPnLForSL",
      "enabled": true
    }
  },
  {
    "id": "max_position_notional",
    "name": "maxPositionNotional",
    "version": "1.0.0",
    "description": "\ncalculate the max position notional\nmax_notional = ( (1/ (leverage * imr_factor) ) ^ (1/0.8)",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "leverage",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "IMRFactor",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number"
        }
      }
    ],
    "formulaText": "{\n  const { leverage, IMRFactor } = inputs;\n  return new Decimal(1)\n    .div(new Decimal(leverage).mul(IMRFactor))\n    .pow(1 / 0.8)\n    .toNumber();\n}",
    "sourceCode": "export function maxPositionNotional(inputs: {\n  /** symbol leverage */\n  leverage: number;\n  IMRFactor: number;\n}) {\n  const { leverage, IMRFactor } = inputs;\n  return new Decimal(1)\n    .div(new Decimal(leverage).mul(IMRFactor))\n    .pow(1 / 0.8)\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "maxPositionNotional",
      "enabled": true
    }
  },
  {
    "id": "max_position_leverage",
    "name": "maxPositionLeverage",
    "version": "1.0.0",
    "description": "\nsymbol_leverage_max = 1 / ( imr_factor * notional ^ 0.8 )",
    "inputs": [
      {
        "key": "inputs",
        "type": "object",
        "factorType": {
          "baseType": "object",
          "constraints": {},
          "nullable": false,
          "array": false,
          "properties": [
            {
              "key": "IMRFactor",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            },
            {
              "key": "notional",
              "type": "number",
              "factorType": {
                "baseType": "number",
                "nullable": false,
                "array": false
              }
            }
          ]
        }
      }
    ],
    "outputs": [
      {
        "key": "result",
        "type": "number",
        "factorType": {
          "baseType": "number"
        }
      }
    ],
    "formulaText": "{\n  const { IMRFactor, notional } = inputs;\n  return new Decimal(1)\n    .div(new Decimal(IMRFactor).mul(new Decimal(notional).pow(0.8)))\n    .toNumber();\n}",
    "sourceCode": "export function maxPositionLeverage(inputs: {\n  IMRFactor: number;\n  notional: number;\n}) {\n  const { IMRFactor, notional } = inputs;\n  return new Decimal(1)\n    .div(new Decimal(IMRFactor).mul(new Decimal(notional).pow(0.8)))\n    .toNumber();\n}",
    "localNpmInfo": {
      "packageName": "@orderly.network/perp",
      "functionName": "maxPositionLeverage",
      "enabled": true
    }
  }
]