# 需求分析文档

## 文档元数据

| 属性         | 值                                |
| :----------- | :-------------------------------- |
| **需求名称** | SDK Volume Chart Default Settings |
| **需求 ID**  | DEX-2610                          |
| **创建日期** | 2025-12-01                        |
| **负责人**   | Leo He (leo@orderly.network)      |
| **优先级**   | P1                                |
| **状态**     | 分析中                            |
| **关联任务** | DEX-2610                          |

---

## 背景

<!--
  必需章节：描述需求的背景、动机和要解决的问题。
  应包含：业务背景、用户痛点、当前状态、期望改进等。
-->

### 业务背景

Orderly Network SDK 为用户提供交易图表功能，其中包含价格图表和成交量（Volume）指标。为了提升用户体验和数据可视化效果，需要调整 Volume 图表的默认显示设置，使其在用户首次访问时就能以最佳状态呈现。

### 问题描述

当前 Volume 图表的默认配置存在以下问题：

1. **默认显示状态**：Volume 并未作为默认显示项，用户需要手动开启才能在图表中看到成交量数据
2. **默认透明度设置**：Volume 图表的默认透明度（opacity）不是 100%，导致视觉效果不够清晰，影响数据可读性

这些默认设置降低了用户体验，特别是对于新用户和移动端用户，增加了额外的操作步骤，影响了交易决策的效率。

### 目标用户

- **主要用户**：使用 Orderly Network SDK 的交易应用用户
- **使用场景**：
  - 桌面端（Desktop）交易界面
  - 移动端网页（Mobile Web）交易界面
- **用户期望**：打开交易界面时即可看到清晰的成交量数据，无需额外配置

---

## 版本支持

<!--
  明确说明该需求需要实现的平台版本和支持情况。
  需要明确是否支持 desktop（桌面端）和 mweb（移动端网页）。
-->

### 平台支持

| 平台类型    | 是否支持 | 说明                                                                                |
| :---------- | :------- | :---------------------------------------------------------------------------------- |
| **Desktop** | 是       | 支持 Web Desktop 平台，需要确保在桌面浏览器中 Volume 图表默认显示且透明度为 100%    |
| **MWeb**    | 是       | 支持移动端网页浏览器，需要确保在移动设备浏览器中 Volume 图表默认显示且透明度为 100% |

### 版本说明

- 此需求计划在 `sdk_20251211` 版本中发布
- 需要在桌面端和移动端网页版本中都进行验证测试

---

## 需求概述

本需求旨在优化 SDK 中 TradingView 图表组件的默认配置，具体包括将 Volume 指标设置为默认显示状态，并将其透明度设置为 100%。这些改进将同时应用于桌面端和移动端网页版本，为用户提供开箱即用的最佳视觉体验，减少手动配置的需要，提升交易效率。根据 Jira 评论，主要配置需要在 WooFI Pro 项目中完成。

---

## 功能需求

<!-- 详细列出所有功能点，使用结构化格式便于AI解析 -->

### 核心功能

#### 功能点 1: 设置 Volume 为默认显示

**描述**: 在 SDK 的图表配置中，将 Volume（成交量）指标设置为默认启用状态，使其在用户打开交易界面时自动显示，同时适用于桌面端和移动端网页。

**用户故事**: 作为交易用户，我希望在打开交易图表时就能看到成交量数据，以便快速分析市场活跃度和价格趋势。

**输入**:

- SDK 配置文件或初始化参数
- TradingView 图表组件配置

**输出**:

- Volume 指标在图表加载时自动显示
- 适用于桌面端和移动端网页
- 用户无需手动开启即可看到成交量数据

**业务规则**:

- Volume 必须作为默认显示项，无需用户手动开启
- 该设置应在 SDK 层面进行配置（具体在 WooFI Pro 项目中），对所有使用 SDK 的应用生效
- 保持用户的个性化设置优先级（如果用户手动关闭 Volume，应尊重用户选择）
- 桌面端和移动端网页都应支持此默认设置

#### 功能点 2: 设置 Volume 透明度为 100%

**描述**: 将 Volume 指标的默认透明度（opacity）值设置为 100%，确保成交量柱状图清晰可见，提供更好的视觉对比度和数据可读性。

**用户故事**: 作为交易用户，我希望成交量柱状图显示清晰，以便准确判断每个时间段的成交量大小，辅助交易决策。

**输入**:

- TradingView Volume 指标样式配置
- Opacity 参数设置

**输出**:

- Volume 柱状图以 100% 不透明度显示
- 提供更好的视觉对比度和可读性
- 在桌面端和移动端都保持一致的清晰显示效果

**业务规则**:

- 默认 opacity 值必须设置为 100%（或等效的完全不透明值）
- 该设置应在指标初始化时应用
- 用户仍可通过 TradingView 设置界面自行调整透明度
- 桌面端和移动端网页都应应用此默认透明度设置

---

## 功能验收标准

<!--
  必需章节：明确定义功能需求完成的判断标准。
  使用场景化描述，便于后续测试和验证。
-->

#### 场景 1: 桌面端首次加载图表

- **GIVEN**: 用户在桌面浏览器中打开集成了 Orderly SDK 的交易应用
- **WHEN**: 图表组件首次加载完成
- **THEN**:
  - Volume 指标自动显示在价格图表下方
  - Volume 柱状图以 100% 不透明度呈现
  - 用户无需进行任何额外操作即可看到清晰的成交量数据

#### 场景 2: 移动端网页加载图表

- **GIVEN**: 用户在移动设备浏览器中访问集成了 Orderly SDK 的交易应用
- **WHEN**: 图表组件在移动端完成加载
- **THEN**:
  - Volume 指标在移动端视图中默认显示
  - Volume 柱状图透明度为 100%，在小屏幕上也能清晰识别
  - 布局适配移动端屏幕尺寸
  - 视觉显示效果与桌面端保持一致

#### 场景 3: 用户自定义设置保持

- **GIVEN**: 用户已经手动关闭了 Volume 显示或调整了透明度
- **WHEN**: 用户刷新页面或重新登录
- **THEN**:
  - 系统保持用户的个性化设置
  - 不强制恢复为默认配置
  - 用户可通过重置按钮恢复到新的默认设置（如果提供此功能）

#### 场景 4: SDK 集成验证

- **GIVEN**: 开发者使用最新版本的 Orderly SDK 集成到新应用中
- **WHEN**: 应用首次运行且未进行任何自定义配置
- **THEN**:
  - Volume 自动作为默认指标显示
  - 透明度默认为 100%
  - 与 SDK 文档描述的默认行为一致
  - 在桌面端和移动端都表现一致

---

## 约束条件

<!-- 技术、业务、时间等方面的约束 -->

### 技术约束

- 必须基于 TradingView Chart Library 的配置机制实现
- 需要兼容 SDK 现有的配置架构，不破坏现有 API
- 配置应在 WooFI Pro 项目中进行（根据 Jira 评论）
- 保持向后兼容性，不影响已部署的应用
- 需要确保在不同浏览器和版本中表现一致

### 业务约束

- 必须同时支持桌面端和移动端网页
- 不能影响用户的个性化配置能力
- 需符合 Orderly Network 的 UI/UX 设计规范
- 不应影响现有用户的体验（对于已有自定义设置的用户）

### 时间约束

- **截止日期**: 2025-12-11
- **里程碑**: 随 sdk_20251211 版本发布

### 资源约束

- 由 SDK 团队负责实现
- 已在 GitLab 提交相关代码变更（commit: b484f4a39e0931feb668b62fcca5fe8dabdbb1c6）

---

## 依赖关系

<!-- 明确需求的依赖项和被依赖项 -->

### 前置依赖

- TradingView Chart Library 集成和配置模块
- SDK 图表组件初始化流程
- WooFI Pro 项目的配置管理机制

### 后续影响

- 其他使用 Orderly SDK 的应用将自动继承新的默认设置
- 可能需要更新 SDK 文档，说明新的默认行为
- 用户教程和帮助文档可能需要相应更新
- 新版本 SDK 的用户将享受到更好的开箱即用体验

---

## 风险评估

<!-- 识别潜在风险和应对措施 -->

### 技术风险

| 风险项                 | 风险等级 | 影响                                      | 应对措施                                       |
| :--------------------- | :------: | :---------------------------------------- | :--------------------------------------------- |
| TradingView 配置兼容性 |    低    | 可能在某些版本的 TradingView 中表现不一致 | 在多个 TradingView 版本中进行测试验证          |
| 浏览器兼容性           |    低    | 某些旧版浏览器可能不支持透明度设置        | 设置降级方案，确保在不支持的环境中使用备用样式 |
| 用户设置迁移           |    中    | 已有用户的自定义配置可能与新默认设置冲突  | 确保优先保留用户的个性化设置，不强制覆盖       |

### 业务风险

| 风险项       | 风险等级 | 影响                                 | 应对措施                                   |
| :----------- | :------: | :----------------------------------- | :----------------------------------------- |
| 用户习惯改变 |    低    | 部分习惯旧版显示的用户可能需要适应   | 提供明确的配置说明，让用户知道如何调整设置 |
| 性能影响     |    低    | 默认显示更多内容可能略微增加渲染负担 | 优化渲染逻辑，确保性能在可接受范围内       |

---

## 数据模型

<!--
  业务层面的数据模型定义，描述业务实体、属性和业务关系。
  技术实现的数据结构（如数据库表结构、TypeScript类型）应在技术方案文档中设计。
-->

### 实体定义

#### 实体 1: TradingView Volume Configuration

- **业务含义**: TradingView 图表中 Volume 指标的配置项，用于控制 Volume 的显示状态和样式

- **属性定义**:

| 字段名         |  类型   | 必填 | 业务说明            | 业务规则                                       | 示例       |
| :------------- | :-----: | :--: | :------------------ | :--------------------------------------------- | :--------- |
| visible        | boolean |  是  | Volume 是否默认显示 | 默认值必须为 true，表示默认显示                | true       |
| opacity        | number  |  是  | 透明度值            | 取值范围 0-100 或 0-1，默认值必须为 100 或 1.0 | 100 或 1.0 |
| applyToDesktop | boolean |  是  | 是否应用于桌面端    | 默认值应为 true                                | true       |
| applyToMobile  | boolean |  是  | 是否应用于移动端    | 默认值应为 true                                | true       |

### 业务关系说明

Volume Configuration 与 TradingView Chart 配置是包含关系，Volume Configuration 是 Chart 配置的一部分。当 Chart 初始化时，会读取 Volume Configuration 的默认值来设置 Volume 指标的显示状态和样式。

---

## 接口定义

不需要对接 API 接口

**预期变更**:

- SDK 内部将 `indicators.volume.visible` 的默认值设置为 `true`
- SDK 内部将 `indicators.volume.opacity` 的默认值设置为 `100`（或等效值）

---

## 本地存储需求

<!--
  明确说明此需求是否需要在localStorage中保存状态。
  如果有，需要详细说明存储的数据、存储时机、使用场景等。
  如果没有，也需要明确说明。
-->

### 是否需要 localStorage

**此需求不需要使用 localStorage 存储状态**

说明：此需求主要是修改 SDK 的默认配置值，这些配置会在 SDK 初始化时应用。如果用户通过 TradingView 界面自定义了 Volume 的显示状态或透明度，TradingView 库本身可能会处理这些设置的持久化（如果 TradingView 支持的话），但这不是本需求的范围。本需求关注的是首次加载时的默认值设置。

---

## 关联文档

<!-- 关联的UI/UX设计和测试文档 -->

- **UI/UX 设计文档**: 参考 Jira 附件中的截图
  - [image-20251201-083001.png](https://api.atlassian.com/ex/jira/60f43001-6d15-4fc0-b90d-8845e3aa553f/rest/api/3/attachment/content/25509)
  - [image-20251201-083013.png](https://api.atlassian.com/ex/jira/60f43001-6d15-4fc0-b90d-8845e3aa553f/rest/api/3/attachment/content/25510)
- **测试文档**: 待生成（如有需要，可基于功能验收标准生成测试用例）

---

## 参考资料

<!-- 相关的文档、设计稿、原型等 -->

- **Jira Issue**: [DEX-2610](https://orderly-network.atlassian.net/browse/DEX-2610)
- **代码提交**: [GitLab Commit](https://gitlab.com/orderlynetwork/woofi-dex/near-woo-orderly-x/-/commit/b484f4a39e0931feb668b62fcca5fe8dabdbb1c6)
- **相关项目**: WooFI DEX (orderlynetwork/woofi-dex/near-woo-orderly-x)
- **发布分支**: release/20251211
- **Fix Version**: sdk_20251211
- **TradingView 文档**: TradingView Chart Library API Documentation（关于 Volume 指标配置）

---

## 备注

<!-- 其他需要说明的信息 -->

- 此需求的实现主要在 WooFI Pro 项目中进行配置（根据 Jira 评论）
- 代码已提交至 GitLab（commit: b484f4a39e0931feb668b62fcca5fe8dabdbb1c6）
- 需要在桌面端和移动端网页都进行验证测试
- 建议在发布前进行 QA 测试，确保在不同设备和浏览器中表现一致
- 需要确保向后兼容性，不影响已有用户的自定义设置

---

## 变更记录

<!-- 记录需求变更历史 -->

| 版本 | 日期       | 变更内容                          | 变更人                  |
| :--- | :--------- | :-------------------------------- | :---------------------- |
| v1.0 | 2025-12-12 | 初始版本，基于 Jira DEX-2610 创建 | AI 辅助生成（基于模板） |
